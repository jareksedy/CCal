//
//  CCalTests.swift
//  CCalTests
//
//  Created by Yaroslav Sedyshev on 26.04.2023.
//

import XCTest

final class CCalTests: XCTestCase {
    let testCases: [String: Int] = [
        "2+2": 4,
        "(2+4) * (4+6)": 60,
        "234.3+23.2/2+(32.3^4)/2": 544472,
        "45.4*345^3-2/(3+24.2)*99.03-24.22+12.4*45.4/22.1-4.2/2.5+0.3253": 1_864_288_567,
        "((43.5-2)/2.5039*0.255-23.5/25)*5.2^3-244566/99": -2_008,
        "23^9*2*(44.2-12.5)/2.4*9^5/100000000000000": 28_095,
        "((43.5-(1+1))/2.5039*0.255-23.5/(20+5))*5.2^3-244566/(88 + 11)": -2_008,
        "234-2.2^2.04*345-2.4*(3.05+992.99)": -3879,
        "4-2": 2,
        "8*2/4+2^2-6": 2,
        "(1+1)^10": 1_024,
        "1000/10/10/10": 1,
        "2^2^2": 16,
        "1+2+3+4+5+6+7+8+9+10": 55,
        "10-9-8-7-6-5-4-3-2-1": -35,
        "2*3*4*5*6*7*8*9*10": 3_628_800,
        "10/9/8/7/6/5/4/3/2/1": 0,
        "10^0": 1,
        "(2+2)*2": 8,
        "2.5*2.5+2.5*2.5": 12,
        "10-9+8-7+6-5+4-3+2-1": 5,
        "1234+5678-9012*3456/789.012^2+345.6": 7_207,
        "1.2^3.4-2.3*4.5/6.7+8.9": 9,
        "1.23+4.56-7.89*0.12/3.45^6+7.89-4.56/1.23+0.45*8.76-5.43/2.34+9.87": 21,
        "1.23+4.56-7.89*0.12/3.45^6+7.89-4.56/1.23+0.45*8.76-5.43/2.34+9.87^2+9.87*1.23-4.56/0.45+7.89-3.21+0.12^3+9.87": 125,
        "2.2^2.04*345+2.4*(3.05+992.99)-234": 3_879,
        ".23+4.56-7.89*0.12/32.45^6.4+7.209-34.56/1.23+0.45*8.76-5.43/2.34+9.87^2+9.87*1.23-4.56/0.45+7.89-3.21+0.312^3+9.87": 99,
        ]
    
    var rpnCal: RPNCal?

    override func setUpWithError() throws {
        rpnCal = RPNCal()
        rpnCal?.addUpdateOperator([.circumflex: (precedence: 4, binaryOperation: { lhs, rhs in pow(lhs, rhs) })])
    }

    override func tearDownWithError() throws {
        rpnCal = nil
    }

    func testEvaluate() throws {
        for (key, value) in testCases {
            let result = rpnCal?.evaluate(key.stripWhitespaces()) ?? 0
            //print(Int(result), value)
            XCTAssertTrue(Int(result) == value)
        }
    }
}
